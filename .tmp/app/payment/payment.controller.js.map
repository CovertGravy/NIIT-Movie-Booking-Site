{"version":3,"sources":["app/payment/payment.controller.js"],"names":["PaymentComponent","$http","userdata","JSON","parse","sessionStorage","ticket","console","log","card","document","getElementById","expiry","cvc","payform","cardNumberInput","expiryInput","cvcInput","event","field","target","id","value","validate","exp","validateCardNumber","mmyy","parseCardExpiry","validateCardExpiry","month","year","validateCardCVC","session","cardnumber","undefined","cardname","post","movie","state","city","location","date","time","tickets","seats","then","alert","setItem","removeItem","href","angular","module","component","templateUrl","controller","controllerAs"],"mappings":"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","file":"payment.controller.js","sourcesContent":["'use strict';\n\n(function () {\n\n  class PaymentComponent {\n    constructor($http) {\n      this.$http = $http;\n      this.userdata;\n    }\n\n    $onInit() {\n\n      this.userdata = JSON.parse(sessionStorage.ticket);\n      console.log(this.userdata);\n\n\n\n      //valid format\n      let card = document.getElementById('cardnumber');\n      let expiry = document.getElementById('expiry');\n      let cvc = document.getElementById('cvc');\n                  \n      payform.cardNumberInput(card);\n      payform.expiryInput(expiry);\n      payform.cvcInput(cvc);\n    }\n\n    valid(event) {\n      let field = event.target.id;\n      let value = event.target.value;\n      let validate = {\n        card: false,\n        exp: false,\n        cvc: false\n      }\n\n      console.log(typeof (value));\n      console.log(field, value);\n\n      switch (field) {\n        case 'cardnumber':\n          // let val = value.replace(/(\\d{4})/g, '$1 ').replace(/(^\\s+|\\s+$)/,'');\n          // console.log(val);\n          console.log(payform.validateCardNumber(value));\n          if(payform.validateCardNumber(value)){\n            validate.card = true;\n          }\n          break;\n        \n        case 'expiry':\n          let mmyy = payform.parseCardExpiry(value);\n          console.log(mmyy);\n          console.log(payform.validateCardExpiry(mmyy.month, mmyy.year));\n          if(payform.validateCardExpiry(mmyy.month, mmyy.year)){\n            validate.exp = true;\n          }\n          break;\n\n        case 'cvc':\n          console.log(payform.validateCardCVC(value));\n          if(payform.validateCardCVC(value)){\n            validate.cvc = true;\n          }\n          break;\n          \n      }\n    }\n\n    pay() {\n\n      let session = false;\n      if(sessionStorage.ticket){\n        session = true;\n      }\n      if(this.cardnumber !== undefined && this.expiry !== undefined && this.cvc !== undefined && this.cardname !== undefined && session){\n      this.$http.post('/api/tickets', {\n        movie: this.userdata.movie,\n        state: this.userdata.state,\n        city: this.userdata.city,\n        location: this.userdata.location,\n        date: this.userdata.date,\n        time: this.userdata.time,\n        tickets: this.userdata.tickets,\n        seats: this.userdata.seats\n      }).then(response =>{\n        alert('Success!');\n        sessionStorage.setItem('booked', sessionStorage.ticket);\n        sessionStorage.removeItem(\"ticket\");\n        location.href = '/booked';\n      });\n    }else if(!session){\n      alert('session data unavailable!');\n    }else{\n      alert('Payment credentials incorrect/missing!');\n    }\n    }\n  }\n\n  angular.module('yeomanAppApp')\n    .component('payment', {\n      templateUrl: 'app/payment/payment.html',\n      controller: PaymentComponent,\n      controllerAs: 'paymentCtrl'\n    });\n\n})();\n"]}